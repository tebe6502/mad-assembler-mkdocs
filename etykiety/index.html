<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="TeBe">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Etykiety - Mad-Assembler</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Etykiety";
    var mkdocs_page_input_path = "etykiety.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/armasm.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Mad-Assembler</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../wprowadzenie/">Wprowadzenie</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sposob-uzycia/">Sposób użycia</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../kontrola/">Kontrola asemblacji</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sparta-dos/">Sparta DOS X</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../skladnia/">Składnia</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Etykiety</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#anonimowe">Anonimowe</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lokalne">Lokalne</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#globalne">Globalne</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tymczasowe">Tymczasowe</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#label">?label</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#label-set-value">label SET value</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#automodyfikacji">Automodyfikacji</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lokalne-w-stylu-mae">Lokalne w stylu MAE</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../mnemoniki/">Mnemoniki</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../makro-rozkazy/">Makro rozkazy</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../pseudo-rozkazy/">Pseudo rozkazy</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dyrektywy/">Dyrektywy</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lokal/">Obszar lokalny</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../procedury/">Procedury</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../makra/">Makra</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dyrektywy-kodu/">Dyrektywy generujące kod</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tablice/">Tablice</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../typy/">Typy danych</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../detekcja-cpu/">Detekcja CPU</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../banki-pamieci/">Banki pamięci</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../kod-relokowalny/">Kod relokowalny</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../przyklady/">Przykłady</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../projekty/">Projekty</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Mad-Assembler</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Etykiety</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/tebe6502/mad-assembler-mkdocs/edit/master/docs/etykiety.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="etykiety">Etykiety</h2>
<p>Etykiety zdefiniowane w programie mogą posiadać zasięg lokalny lub globalny, w zależności od miejsca w jakim zostały zdefiniowane. Oprócz tego można zdefiniować etykiety tymczasowe, które także mogą posiadać zasięg lokalny lub globalny.</p>
<ul>
<li>
<p>zasięg globalny etykiety oznacza, że jest ona widoczna z każdego miejsca w programie, niezależnie czy jest to makro <code>.MACRO</code>, procedura <code>.PROC</code> czy obszar lokalny <code>.LOCAL</code>.</p>
</li>
<li>
<p>zasięg lokalny etykiety oznacza, że jest ona widoczna tylko w konkretnie zdefiniowanym obszarze, np. przez dyrektywy: <code>.MACRO</code>, <code>.PROC</code>, <code>.LOCAL</code>.</p>
</li>
<li>
<p>etykiety muszą zaczynać się znakiem <code>'A'..'Z','a'..'z','_','?','@'</code></p>
</li>
<li>pozostałe dopuszczalne znaki etykiety to <code>'A'..'Z','a'..'z','0'..'9','_','?','@'</code></li>
<li>etykiety występują zawsze na początku wiersza</li>
<li>etykiety poprzedzone "białymi znakami" powinny kończyć się znakiem <code>:</code> aby uniknąć błędnej interpretacji takiej etykiety jako makra</li>
<li>w adresowaniu etykieta może być poprzedzona znakiem <code>:</code> informuje to asembler że odwołujemy się do etykiety w bloku głównym programu (odwołujemy się do etykiety globalnej)</li>
</ul>
<p>Przykład definicji etykiet:</p>
<pre><code>?nazwa   EQU  $A000    ; definicja etykiety tymczasowej globalnej
nazwa     =   *        ; definicja etykiety globalnej
nazwa2=12              ; definicja etykiety globalnej
@?nazwa  EQU  'a'+32   ; definicja etykiety globalnej
  name: equ 12         ; definicja etykiety globalnej nie zaczynającej się od pierwszego znaku wiersza
         nazwa: = 'v'  ; definicja etykiety globalnej nie zaczynającej się od pierwszego znaku wiersza
</code></pre>
<p>W porównaniu do <strong>QA/XASM</strong> doszła możliwość użycia znaku zapytania <code>?</code> i <code>@</code> w nazwach etykiet.
Użycie znaku kropki <code>.</code> w nazwie etykiety jest dopuszczalne, jednak nie zalecane. Znak kropki zarezerwowany jest do oznaczania rozszerzenia mnemonika, do oznaczenia dyrektyw assemblera, w adresowaniu nowych struktur <strong>MADS</strong>.</p>
<p>Znak kropki <code>.</code> na początku nazwy etykiety sugeruje że jest to dyrektywa assemblera, natomiast znak zapytania <code>?</code> na początku etykiety oznacza <strong>etykietę tymczasową</strong>, taką której wartość może się zmieniać wielokrotnie w trakcie asemblacji.</p>
<h3 id="anonimowe">Anonimowe</h3>
<p>W celu zapewnienia przejrzystości kodu użycie etykiet anonimowych ograniczone jest tylko dla skoków warunkowych oraz do 10-u wystąpień w przód/tył.</p>
<p>Dla etykiet anonimowych został zarezerwowany znak <code>@</code>, po takim znaku musi wystąpić znak określający skok w przód <code>+</code> lub w tył <code>-</code>. Dodatkowo można określić numer wystąpienia etykiety anonimowej z zakresu <code>[0..9]</code>, brak numeru wystąpienia oznacza domyślnie <code>0</code>.</p>
<pre><code> @+[0..9]     ; forward
 @-[0..9]     ; backward

 @+           ; @+0
 @-           ; @-0

@ dex   ---- -------
  bne @+   |  --   |
  stx $80  |   |   |
@ lda #0   |  --   |
  bne @- ---       |
  bne @-1  ---------

  ldx #6
@ lda:cmp:req 20
@ dex
  bne @-1
</code></pre>
<h3 id="lokalne">Lokalne</h3>
<p>Każda definicja etykiety w obrębie makra <code>.MACRO</code>, procedury <code>.PROC</code> czy obszaru lokalnego <code>.LOCAL</code> domyślnie jest zasięgu lokalnego, innymi słowy jest lokalna. Takich etykiet użytkownik nie musi dodatkowo oznaczać.</p>
<p>Etykiety lokalne definiujemy używając n/w równoważnych pseudo rozkazów:</p>
<pre><code> EQU
  =
</code></pre>
<p>Aby mieć dostęp do etykiet o zasięgu globalnym (czyli zdefiniowanych poza makrem <code>.MACRO</code>, procedurą <code>.PROC</code>, obszarem lokalnym <code>.LOCAL</code>) i o takich samych nazwach jak lokalne, należy użyć operatora <code>:</code>, np.:</p>
<pre><code>lp   ldx #0         ; definicja globalna etykiety LP

     test
     test

test .macro

      lda :lp       ; znak ':' przed etykietą odczyta wartość etykiety globalnej LP

      sta lp+1      ; odwołanie do etykiety lokalnej LP w obszarze makra
lp    lda #0        ; definicja etykiety lokalnej LP w obszarze makra

     .endm
</code></pre>
<p>W w/w przykładzie występują definicje etykiet o tych samych nazwach (LP), lecz każda z nich ma inną wartość i jest innego zasięgu.</p>
<h3 id="globalne">Globalne</h3>
<p>Każda definicja etykiety dokonana w głównym bloku programu poza obszarem makra <code>.MACRO</code>, procedury <code>.PROC</code> czy obszaru lokalnego <code>.LOCAL</code> jest zasięgu globalnego, innymi słowy jest globalna.</p>
<p>Etykiety globalne definiujemy używając n/w równoważnych pseudo rozkazów:</p>
<pre><code> EQU
  =
</code></pre>
<p>lub dyrektywy <code>.DEF</code> o składni:</p>
<pre><code>    .DEF :label [= expression]
</code></pre>
<p>Dyrektywa <code>.DEF</code> umożliwia zdefiniowanie etykiety w aktualnym obszarze lokalnym, znak <code>:</code> na początku etykiety sygnalizuje etykietę globalną. Użycie dyrektywy o składni <code>.DEF :label</code> pozwala na zdefiniowanie etykiety globalnej z pominięciem aktualnego poziomu lokalności.</p>
<p>Znak dwukropka <code>:</code> na początku etykiety ma specjalne znaczenie, informuje że odwołujemy się do etykiety globalnej, czyli etykiety z głównego bloku programu z pominięciem wszystkich poziomów lokalności.</p>
<p>Więcej informacji na temat użycia dyrektywy <code>.DEF</code> w rozdziale <a href="#def">Dyrektywa .DEF</a></p>
<p>Przykład definicji etykiet globalnych:</p>
<pre><code>lab equ *
   lab2 equ $4000

    ?tmp = 0
    ?tmp += 40

.proc name

      .def :?nazwa   = $A000
           .def :nazwa=20

      .local lok1
        .def :@?nazw   = 'a'+32
      .endl

.endp
</code></pre>
<p>Przykładem zastosowania definicji etykiety globalnej tymczasowej jest m.in. makro <code>@CALL</code>, przykład w pliku <code>..\EXAMPLES\MACROS\@CALL.MAC</code>, w którym występuje definicja etykiety tymczasowej <code>?@STACK_OFFSET</code>. Jest ona później wykorzystywana przez pozostałe makra wywoływane z poziomu makra <code>@CALL</code>, a służy do optymalizacji programu odkładającego parametry na stos programowy.</p>
<pre><code>@CALL .macro

  .def ?@stack_offset = 0    ; definicja etykiety globalnej tymczasowej ?@stack_offset

  ...
  ...


@CALL_@ .macro

  sta @stack_address+?@stack_offset,x
  .def ?@stack_offset = ?@stack_offset + 1    ; modyfikacja etykiety ?@stack_offset

 .endm
</code></pre>
<h3 id="tymczasowe">Tymczasowe</h3>
<p>Definicja etykiety tymczasowej posiada tą właściwość, że jej wartość może ulegać zmianie wielokrotnie nawet podczas jednego przebiegu asemblacji. Normalnie próba ponownej definicji etykiety kończy się komunikatem <em><strong>Label declared twice</strong></em>. Nie będzie takiego komunikatu jeśli jest to etykieta tymczasowa.</p>
<p>Zasięg etykiet tymczasowych uzależniony jest od obszaru w jakim etykieta została zdefiniowana. Etykiety tymczasowe mogą posiadać zasięg lokalny (<a href="#lokalne">Etykiety lokalne</a>) lub globalny (<a href="#globalne">Etykiety globalne</a>).</p>
<h4 id="label">?label</h4>
<p>Etykietę tymczasową definiuje użytkownik poprzez umieszczenie na początku nazwy etykiety znaku zapytania <code>?</code>, np.:</p>
<pre><code>?label
</code></pre>
<p>Etykiet tymczasowych nie powinno używać się do nazw procedur <code>.PROC</code>, makr <code>.MACRO</code>, obszarów lokalnych <code>.LOCAL</code>, struktur <code>.STRUCT</code>, tablic <code>.ARRAY</code>.</p>
<p>Etykiety tymczasowe definiujemy używając n/w równoważnych pseudo rozkazów:</p>
<pre><code> EQU
  =
</code></pre>
<p>Dodatkowo możemy je modyfikować za pomocą znanych z <strong>C</strong> operatorów:</p>
<pre><code>    -= expression
    += expression
    --
    ++
</code></pre>
<p>W/w operatory modyfikujące dotyczą tylko etykiet tymczasowych, próba ich użycia dla innego typu etykiety skończy się komunikatem błędu <em><strong>Improper syntax</strong></em>.</p>
<p>Przykład użycia etykiet tymczasowych:</p>
<pre><code>?loc = $567
?loc2 = ?loc+$2000

     lda ?loc
     sta ?loc2

?loc = $123

     lda ?loc
</code></pre>
<h4 id="label-set-value">label SET value</h4>
<p>Pseudorozkaz <a href="#set">SET</a> umożliwia redefinicję etykiety <code>LABEL</code>, działa ze zwykłymi etykietami tzn. takimi które nie mają pierwszego znaku w nazwie <code>?</code>. Etykiet zdefiniowanych przez <code>SET</code> nie można później definiować inaczej niż przez <code>SET</code>.</p>
<pre><code> tmp set 1

 tmp = 2
</code></pre>
<p>Dla w/w przykładu powstanie nieskończona pętla <strong>Infinite loop</strong>, prawidłowo powinno być :</p>
<pre><code> tmp set 1

 tmp set 2
</code></pre>
<h3 id="automodyfikacji">Automodyfikacji</h3>
<p>Etykieta dłuższa niż 1 znak, umieszczona po mnemoniku i zakończona znakiem <code>:</code> definiuje adres automodyfikacji kodu.</p>
<pre><code>  lda label:#$00

  add plus:#$00

  lda src:$ff00,y
  sta dst:$ff00,y
</code></pre>
<p>W/w przykłady są odpowiednikiem kodu:</p>
<pre><code>  lda #$00
label equ *-1

  add #$00
plus equ *-1

  lda $ff00,y
src equ *-2

  sta $ff00,y
dst equ *-2
</code></pre>
<h3 id="lokalne-w-stylu-mae">Lokalne w stylu MAE</h3>
<p>Opcja <code>OPT ?+</code> informuje <strong>MADS</strong> aby etykiety zaczynające się znakiem <code>?</code> interpretował jako etykiety lokalne tak jak robi to <strong>MAE</strong>. Domyślnie etykiety zaczynające się znakiem <code>?</code> traktowane są przez <strong>MADS</strong> jako etykiety tymczasowe.</p>
<p>Przykład użycia etykiet lokalnych w stylu <strong>MAE</strong>:</p>
<pre><code>       opt ?+
       org $2000

local1 ldx #7
?lop   sta $a000,x
       dex
       bpl ?lop

local2 ldx #7
?lop   sta $b000,x
       dex
       bpl ?lop
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mnemoniki/" class="btn btn-neutral float-right" title="Mnemoniki">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../skladnia/" class="btn btn-neutral" title="Składnia"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/tebe6502/mad-assembler-mkdocs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../skladnia/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mnemoniki/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
